pipeline {

    parameters {
        string(name: 'IMG_REGISTRY', defaultValue: 'infobloxcto')
    }

    agent {
        label 'cdnsfw_dockerhub_ami'
    }

    stages {
        stage("Lint") {
            steps {
                sh '''
                    REGISTRY=$IMG_REGISTRY

                    echo "REGISTRY=${REGISTRY}"
                '''
            }
        }
        stage("Test") {
            steps {
                def IMAGE_NAMES_LIST = sh (
                    script: '''
                        echo "jenkinstest"
                    ''',
                    returnStdout: true
                    ).trim().split(" ")
                echo IMAGE_NAMES_LIST
            }
        }
        stage("Build") {
            steps {
                def IMAGE_VERSION = sh (
                        script: '''
                            echo "v2.0.0"
                        ''',
                        returnStdout: true
                    ).trim().split(" ")
                echo IMAGE_VERSION
            }
        }
        stage("Push") {
            when {
                anyOf {
                    branch "master"
                    buildingTag()
                }
            }
            steps {
                echo "${env.IMG_REGISTRY}"
            }
        }
    }
}